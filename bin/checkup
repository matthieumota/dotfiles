#!/bin/zsh
source ~/.zshrc

echo -e "\nReady? ðŸ»\n"

echo -e "â–¶ï¸  Check npm update\n"
ncu -g
echo -e "â–¶ï¸  Check bun update\n"
bun upgrade
echo -e "â–¶ï¸  Check composer update\n"
composer global outdated
echo -e "â–¶ï¸  Check nvm update\n"
nvm ls-remote | tail -n1
echo "Current: $(nvm current)"
echo -e "â–¶ï¸  Check rust and cargo update\n"
rustup update
cargo install-update -l
echo -e "â–¶ï¸  Check go update\n"
GO_TOOLS=(github.com/air-verse/air github.com/goreleaser/goreleaser/v2)
for tool in "${GO_TOOLS[@]}"; do
    echo "â†» $tool\n"
    go install "$tool@latest"
done

if [ "$(uname)" = "Darwin" ]; then
    echo -e "â–¶ï¸  Check Mac App Store update\n"
    mas outdated

    echo -e "â–¶ï¸  Check default config\n"
    for file in $(find $HOMEBREW_PREFIX -name "*.default"); do
        defaultFile=$(echo $file | sed 's/.default//')
        diff "$file" "$defaultFile" > /dev/null
        if [ $? -eq 1 ]; then
            echo "diff : $defaultFile"
        else
            echo "nodiff : $defaultFile"
        fi
    done
fi

if [ "$(cat /etc/os-release 2> /dev/null | grep -o "Arch" | head -n1)" = "Arch" ]; then
    echo -e "â–¶ï¸  Check default config\n"
    for file in $(find / -name "*.pacnew" -o -name "*.pacsave" 2> /dev/null); do
        defaultFile=$(echo $file | sed 's/.pacnew//' | sed 's/.pacsave//')
        diff "$file" "$defaultFile" > /dev/null
        if [ $? -eq 1 ]; then
            echo "diff : $defaultFile"
        else
            echo "nodiff : $defaultFile"
        fi
    done
fi

echo -e "\nFinished! ðŸŽ‰\n"
